# Mdjs开发手册
> Mdjs是一个轻量级的Js的Markdown文件解析器

---
文档更新时间:`2016年01月01日`
作者:`刘越(hangxingliu)`

[TOC]

## 开源声明

Mdjs遵循[Apache Licence 2.0](LICENSE)

> 允许使用在商业应用中,允许通过修改来满足实际需求(但需要在被修改的文件中说明).

## 核心类

	window.Mdjs

## 版本更新

### `设想` 0.4 Dev 这个版本我应该会更新:

> 1. 脚注
> 2. 参考式链接

### 0.32 Dev `2016/01/01`

- 优化了只有一张图片的一行Markdown语句解析的输出效果
- 优化了通过Tab键组成的代码块的解析(每行代码前面的Tab不会显示出来了,允许中间有空白行,代码块末尾的空白行不会被包括)
- 多个空白行能被解析成一个空白行
- 修复了图片或链接的地址中的_*导致粗体,斜体的Bug

### 0.31 Dev `2015/12/28`

- 支持了引用区块的嵌套
- 注意:`Mdjs.handlerLines`支持两个参数了,第二个参数(**Boolean**)表示解析的内容是否为引用区块内的内容

### 0.3 Dev `2015/12/15`

- 支持表格语句了(支持左右居中对齐)
- 修复了Hr横线的Bug
- 支持了链接内嵌入图片的语法,例如:\[图片:!\[\]\(图片URL\)\]\(链接URL\)
- 修复了一点链接/图片的Bug,URL有*_符号的时候的Bug
- 优化了输出格式,包括一些多余的换行
- 修复了由于系统换行符不同导致的Markdown解析出错
- 修复了代码块内没有HTML转义的Bug
- TOC目录增加了链接跳转到指定标题
- 修复了### xxx ###此类标题的Bug

### 0.2 Dev `2015/12/04`

- 修复了一个区块引用换行的BUG
- 表示粗体斜体使用下划线表示
- 列表支持+号表示
- 支持了Hr横线表示上一行标题,以及Hr横线中可以有空格
- 对图片的展位字符串进行了 HTML转义
- < >表示的自动链接
- 如果\[,\],(,),<,>,!没有语义则可以正常输出

### 0.1 Dev `2015/12/03`

- 首个版本

## 目前支持

> 目前用的最多的最广的的Markdown语法都能被解析

- **标题**(支持右端有\#,允许行内样式,也可以通过下一行表示Hr横线来表达)
- **引用**\(除了第一行引用,紧接着的引用文本可以不用>符号\)
- **目录**\(TOC,生成的目录可以自动去掉标题中的样式\)
- **图片**\(可以嵌套到链接内)
- **粗体,斜体**\(行内样式可以叠加,可以使用下划线或星号)
- **超链接**(支持自动链接)
- **有序列表,无序列表**\(支持:`-*数字`\)
- **代码**\(行内代码,\`\`\`代码块,用tab键组成的代码块\)
- **转义字符**(\[,\],(,),<,>在没有语义也可以正常输出)
- **HTML标签**
- **水平分割线**\(---,\*\*\*,\_\_\_,===,中间也可以有空格)
- **表格**\(支持对齐表示法:--,:--:,--:)

## 暂不支持

1. 脚注
2. 参考式的链接
3. 公式,图表.....(这些没有打算支持)


## 解析原理(源码分析)

> 由于不是专业的前端开发,所以代码的风格可能收到C/Java/PHP...多种语言的影响,请多多见谅
> 我源码中的JSDoc和注释其实写的比较详细

> **建议大家不要去看0.3以前的版本的代码!!**,由于个人对Javascript的理解不够深入,对this的使用心存疑惑,所以0.3Dev以前的版本误用了this和self.

### 我代码内的一些概念

`整行样式` : 比如标题,列表,引用,代码....

`行内样式` :	比如加粗,倾斜,行内代码...

`表格格式行`: 在Markdown中表示表格的第二行语句(可以表明表格每一列的对齐样式),例如:`:-|:-:|-:`

### 主线

1. `Mdjs.md2html`:负责拆解Markdown文本成一行一行
	1. `Mdjs.handlerLines`:负责将一行一行的Markdown语句解析
		1. `Mdjs.handlerList`:负责处理列表行
		2. `Mdjs.handlerListEnd`:负责处理列表的结尾
		3. `Mdjs.handlerTOC`:负责生成目录的HTML
		4. `Mdjs.genTbTr`:负责生成表格每一行的HTML
		5. `Mdjs.handlerTbFmt`:负责分析表格的格式行
			1. `Mdjs.handlerTbLine`:负责判断分解表格语句的行
			2. `Mdjs.handlerInline`:负责将一行没有了其他例如标题,引用这些头部标记的Markdown语句\(即解析一些行内样式\)

### 工具

- `Mdjs._inArray` 判断元素在数组内吗?
- `Mdjs._isHr` 一句语句是水平分割线(hr横线)吗?
- `Mdjs._isAList`一句语句是列表吗?
- `Mdjs._leftSpace`一个语句的前面有多少个空格/Tab键
- `Mdjs._htmlSafer`字符串的HTML转义
- `Mdjs._isExpressAOrImage`判断一个语句从一个位置开始后面还有没有](...)的结构,即判断`[`是否有表示链接或图片的结构含义
- `Mdjs._genSpace` 生成指定长度(小于1024)的空格字符串
- `Mdjs._startWith` 判断字符串是否具有指定前缀
- `Mdjs._endWith` 判断字符串是否具有指定后缀

### 栈

> 我写 0.2 Dev版时才发现原来Javascript的数组元素可以push和pop的....

- 处理列表的时候使用
- 其实在输出TOC目录的时候也用到了一个在函数内的栈结构

### 自定义样式

1. 自定义生成的HTML元素,可以修改`Mdjs.tag`下对应的元素的HTML代码
2. 自定义行内样式,可以修改`Mdjs.inlineTag`下对应样式的HTML代码
3. 自定义表格样式以及对齐的样式,可以在样式表中设置以下4个样式:
	1.`.md_table` 表格
	2.`.md_table_left` 表格中左对齐的列
	3.`.md_table_mid` 表格中居中对齐的列
	4.`.md_table_right` 表格中右对齐的列
4. 自定义TOC目录的样式,可以在样式表中设置样式`.md_toc`


## 开发参考资料

> Markdown语法参考:
> [Markdown 语法说明 (简体中文版)](http://www.appinn.com/markdown/)
> 
> 一个我很喜欢的Markdown编辑器(有在线版和离线版的)
> [马克飞象](https://maxiang.io/)