window.Mdjs={regs:{ul:/^[\*\-\+] +\S*/g,ol:/^\d+\. +\S*/g,delHTML:/<\/?[^<>]+>/g,},tag:{tBlock:["<blockquote><p>","</p></blockquote>"],tCode:['<pre><code data-lang="$lang">',"</code></pre>"],tList:["<li>","<ol>","<ul>","</li>"],tP:["<p>","</p>"],tToc:['<div class="md_toc">',"<ol>","</ol>","</div>"],tA:['<a href="mailto:','<a href="','">',"</a>"],},inlineTag:{tStrong:["<strong>","</strong>"],tEm:["<em>","</em>"],tCode:["<code>","</code>"],tA:['<a href="','">',"</a>"],tImg:['<img src="','" title="','" />'],},_meaning:"#`*[]()-_{}+.!\\",_inArray:function(c,a){for(var b=0;b<a.length;b++){if(c==a[b]){return true}}return false},_isHr:function(d){var e=d[0];if(e!="="&&e!="-"&&e!="_"&&e!="*"){return false}for(var a=0,b=1;a<d.length;a++){if(d[a]==" "||d[a]=="\t"){continue}if(d[a]!=e){return false}b++;if(b==3){break}}return b==3},_isAList:function(a){if(Mdjs._isHr((a))){return 0}if(a.search(Mdjs.regs.ol)!=-1){return 1}if(a.search(Mdjs.regs.ul)!=-1){return 2}return 0},_leftSpace:function(c){var a=0;for(var b=0;b<c.length;b++){if(c[b]==" "){a++}else{if(c[b]=="\t"){a+=4}else{break}}}return a},_htmlSafer:function(a){var a=a.replace(/&/g,"&gt;");return a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;").replace(/\n/g,"</br>")},_isExpressAOrImg:function(b,c){while(true){var a=b.indexOf("](",c);if(a==-1){return false}if(b[a-1]=="\\"&&b[a-2]!="\\"){c=a+2;continue}while(true){a=b.indexOf(")",a+1);if(a==-1){return false}if(b[a-1]=="\\"&&b[a-2]!="\\"){continue}return true}}},_inn:[],_inn2:[],_innLen:0,_iTop:function(){return Mdjs._innLen==0?-1:Mdjs._inn[Mdjs._innLen-1]},_iTop2:function(){return Mdjs._inn2[Mdjs._innLen-1]},_iPush:function(a,b){Mdjs._inn[Mdjs._innLen]=a;Mdjs._inn2[Mdjs._innLen++]=b},_iPop:function(){if(Mdjs._innLen==0){return false}Mdjs._innLen--;return true},md2html:function(b,a){self=Mdjs;return Mdjs.handlerLines(b.split(/[\n|\r]/g))},handlerLines:function(s){var v="";var d=0;var h="";var t=0;var c=-1;var e=[];var f=[];var n=0;var g="";for(var r=0;r<s.length;r++){h=s[r].trim();if(d>0){if(h=="```"){d=0;v+=self.tag.tCode[1];continue}v+=(d==1?"":"\n")+s[r],d++;continue}t=self._leftSpace(s[r]);var o=self._isAList(h);if(o!=0){v+=self.handlerList(t,o,h);continue}v+=self.handlerListEnd();if(h.length==0){v+="<br />";continue}if(t<4){if(h.slice(0,3)=="```"){lang=h.slice(3).trim();v+=self.tag.tCode[0].replace("$lang",lang);d=1;continue}for(var q=0;q<h.length;q++){if(h[q]!="#"){break}}if(q!=0){var a=h.indexOf("#",q);var m=a==-1?h.slice(q):h.slice(a);e[n]=m=self.handlerInline(m,0);f[n++]=q;v+="<h"+q+">"+m+"</h"+q+">\n";continue}if(h[0]==">"&&h.length>1){v+=self.tag.tBlock[0]+self.handlerInline(h,1)+"<br />";for(var p=r+1;p<s.length;p++){g=s[p].trim();if(g.length==0){break}if(g[0]==">"){g=g.slice(1)}v+=g+"<br />"}v+=self.tag.tBlock[1];r=p-1;continue}if(self._isHr(h)){v+="<hr />";continue}if(h=="[TOC]"){c=v.length;continue}}else{if(r==0||s[r-1].trim().length==0){v+=self.tag.tCode[0].replace("$lang","")+self.handlerInline(s[r],0);for(var q=r+1;q<s.length;q++){if(self._leftSpace(s[q])<4){break}v+="\n"+self.handlerInline(s[q],0)}v+=self.tag.tCode[1];r=q-1;continue}}if(r+1<s.length){g=s[r+1].trim();if(self._isHr(g)){var b=3;if(g[0]=="="){b=1}else{if(g[0]=="-"){b=2}}e[n]=m=self.handlerInline(h,0);f[n++]=b;v+="<h"+b+">"+m+"</h"+b+">\n";r++;continue}}v+=self.tag.tP[0]+self.handlerInline(h,0)+self.tag.tP[1]}if(c!=-1){var u=v.slice(0,c);v=v.slice(c);v=u+self.handlerTOC(e,f,n)+v}return v},handlerTOC:function(a,b,h){var e=self.tag.tToc[0];var c=[];var g=0;var f;for(var d=0;d<h;d++){f="<li>"+a[d].replace(self.regs.delHTML,"")+"</li>";if(g==0||b[d]>c[g-1]){e+=self.tag.tToc[1]+f;c[g++]=b[d]}else{if(b[d]==c[g-1]){e+=f}else{e+=self.tag.tToc[2];g--;d--}}}while((g--)>0){e+=self.tag.tToc[2]}return e+self.tag.tToc[3]},handlerListEnd:function(){var a="";while(self._iTop()!=-1){if(self._iTop2()==1){a+="</ol>\n"}else{a+="</ul>\n"}self._iPop()}return a},handlerList:function(f,d,e){var a=self._iTop();var c=self.tag.tList[0]+self.handlerInline(e,e.indexOf(" "),0)+self.tag.tList[3];var b="";if(f>a){self._iPush(f,d);return self.tag.tList[d]+c}else{if(f==a){return c}else{while(f<a){if(self._iTop2()==1){b+="</ol>\n"}else{b+="</ul>\n"}self._iPop();a=self._iTop()}if(a==-1){self._iPush(f,d);return b+self.tag.tList[d]+c}else{return b+c}}}},handlerInline:function(l,d){var k=l+"\\";var p=k.length-1;var s="";var c=0;var e=0;var h=0;var a="*";var j="*";var f=false;var r="a";var q=false;var g="";var b="";var m=0;var n=true;for(var o=(d<0?0:d);o<p;o++){switch(k[o]){case"\\":if(self._inArray(k[o+1],self._meaning)){b=k[++o]}else{b=k[o]}if(q){g+=b}else{s+=b}break;case"`":s+=self.inlineTag.tCode[h];h=1^h;break;case"*":case"_":if(k[o+1]==k[o]){if(c==0){a=k[o]}else{if(k[o]!=a){if(q){g+=k[o]+k[o]}else{s+=k[o]+k[o]}o++;break}}s+=self.inlineTag.tStrong[c];c=1^c;o++}else{if(e==0){j=k[o]}else{if(k[o]!=j){if(q){g+=k[o]}else{s+=k[o]}break}}s+=self.inlineTag.tEm[e];e=1^e}break;case"!":if(k[o+1]=="["){r="i"}else{if(q){g+="!"}else{s+="!"}}break;case"[":n=self._isExpressAOrImg(k,o);if(n){console.log(g)}if(!n||f){b="[";if(k[o-1]=="!"){b="![";r=""}if(q){g+=b}else{s+=b}}else{f=true;q=true;g=""}break;case"]":if(f){q=false}else{if(q){g+="]"}else{s+="]"}}break;case"(":if(!f){s+="(";break}if(r=="i"){s+=self.inlineTag.tImg[0]}else{s+=self.inlineTag.tA[0]}break;case")":if(!f){s+=")";break}if(r=="i"){s+=self.inlineTag.tImg[1]}else{s+=self.inlineTag.tA[1]}if(r=="i"){s+=self._htmlSafer(g)+self.inlineTag.tImg[2]}else{s+=g+self.inlineTag.tA[2]}r="";break;case"<":if(!q){m=k.indexOf(">",o);if(m!=-1){b=k.slice(o+1,m);if(b.search(/$\/?[\w ]*^/g)==-1){if(b.search(/^\w+:\/\/\S*/g)==0){s+=self.tag.tA[1]+b+self.tag.tA[2]+b+self.tag.tA[3];o=m;break}if(b.search(/^\S+@\S+\.\w+$/g)==0){s+=self.tag.tA[0]+b+self.tag.tA[2]+b+self.tag.tA[3];o=m;break}}}else{if(q){g+=k[o]}else{s+="&lt;"}break}}default:if(q){g+=k[o]}else{s+=k[o]}}}if(h==1){s+=self.inlineTag.tCode[1]}if(e==1){s+=self.inlineTag.tEm[1]}if(c==1){s+=self.inlineTag.tStrong[1]}return s},};