window.Mdjs={regs:{ul:/^[\*\-] +\S*/g,ol:/^\d+\. +\S*/g,delHTML:/<\/?[^<>]+>/g,},tag:{tBlock:["<blockquote><p>","</p></blockquote>"],tCode:['<pre><code data-lang="$lang">',"</code></pre>"],tList:["<li>","<ol>","<ul>","</li>"],tP:["<p>","</p>"],tToc:['<div class="md_toc">',"<ol>","</ol>","</div>"],},inlineTag:{tStrong:["<strong>","</strong>"],tEm:["<em>","</em>"],tCode:["<code>","</code>"],tA:['<a href="','">',"</a>"],tImg:['<img src="','" title="','" />'],},_meaning:"#`*[]()-_{}+.!\\",_inArray:function(c,a){for(var b=0;b<a.length;b++){if(c==a[b]){return true}}return false},_isHr:function(b){var d=b[0];if(d!="="&&d!="-"&&d!="_"){return false}if(b.length<3){return false}for(var a=0;a<b.length;a++){if(b[a]!=d){return false}}return true},_isAList:function(a){if(a.search(Mdjs.regs.ol)!=-1){return 1}if(a.search(Mdjs.regs.ul)!=-1){return 2}return 0},_leftSpace:function(c){var a=0;for(var b=0;b<c.length;b++){if(c[b]==" "){a++}else{if(c[b]=="\t"){a+=4}else{break}}}return a},_inn:[],_inn2:[],_innLen:0,_iTop:function(){return Mdjs._innLen==0?-1:Mdjs._inn[Mdjs._innLen-1]},_iTop2:function(){return Mdjs._inn2[Mdjs._innLen-1]},_iPush:function(a,b){Mdjs._inn[Mdjs._innLen]=a;Mdjs._inn2[Mdjs._innLen++]=b},_iPop:function(){if(Mdjs._innLen==0){return false}Mdjs._innLen--;return true},md2html:function(b,a){self=Mdjs;return Mdjs.handlerLines(b.split(/[\n|\r]/g))},handlerLines:function(t){var p="";var n=0;var b="";var c=0;var s=-1;var g=[];var q=[];var r=0;var o="";for(var m=0;m<t.length;m++){b=t[m].trim();if(n>0){if(b=="```"){n=0;p+=self.tag.tCode[1];continue}p+=(n==1?"":"\n")+t[m],n++;continue}c=self._leftSpace(t[m]);var d=self._isAList(b);if(d!=0){p+=self.handlerList(c,d,b);continue}p+=self.handlerListEnd();if(b.length==0){p+="<br />";continue}if(c<4){if(b.slice(0,3)=="```"){lang=b.slice(3).trim();p+=self.tag.tCode[0].replace("$lang",lang);n=1;continue}for(var h=0;h<b.length;h++){if(b[h]!="#"){break}}if(h!=0){var f=b.indexOf("#",h);var u=f==-1?b.slice(h):b.slice(f);g[r]=u=self.handlerInline(u,0);q[r++]=h;p+="<h"+h+">"+u+"</h"+h+">\n";continue}if(b[0]==">"&&b.length>1){p+=self.tag.tBlock[0]+self.handlerInline(b,1)+"\n";for(var e=m+1;e<t.length;e++){o=t[e].trim();if(o.length==0){break}if(o[0]==">"){o=o.slice(1)}p+=o+"\n"}p+=self.tag.tBlock[1];m=e-1;continue}if(self._isHr(b)){p+="<hr />";continue}if(b=="[TOC]"){s=p.length;continue}p+=self.tag.tP[0]+self.handlerInline(b,0)+self.tag.tP[1];continue}else{if(m==0||t[m-1].trim().length==0){p+=self.tag.tCode[0].replace("$lang","")+self.handlerInline(t[m],0);for(var h=m+1;h<t.length;h++){if(self._leftSpace(t[h])<4){break}p+="\n"+self.handlerInline(t[h],0)}p+=self.tag.tCode[1];m=h-1}else{p+=self.tag.tP[0]+self.handlerInline(b,0)+self.tag.tP[1]}continue}}if(s!=-1){var a=p.slice(0,s);p=p.slice(s);p=a+self.handlerTOC(g,q,r)+p}return p},handlerTOC:function(a,b,h){var e=self.tag.tToc[0];var c=[];var g=0;var f;for(var d=0;d<h;d++){f="<li>"+a[d].replace(self.regs.delHTML,"")+"</li>";if(g==0||b[d]>c[g-1]){e+=self.tag.tToc[1]+f;c[g++]=b[d]}else{if(b[d]==c[g-1]){e+=f}else{e+=self.tag.tToc[2];g--;d--}}}while((g--)>0){e+=self.tag.tToc[2]}return e+self.tag.tToc[3]},handlerListEnd:function(){var a="";while(self._iTop()!=-1){if(self._iTop2()==1){a+="</ol>\n"}else{a+="</ul>\n"}self._iPop()}return a},handlerList:function(f,d,e){var a=self._iTop();var c=self.tag.tList[0]+self.handlerInline(e,e.indexOf(" "),0)+self.tag.tList[3];var b="";if(f>a){self._iPush(f,d);return self.tag.tList[d]+c}else{if(f==a){return c}else{while(f<a){if(self._iTop2()==1){b+="</ol>\n"}else{b+="</ul>\n"}self._iPop();a=self._iTop()}if(a==-1){self._iPush(f,d);return b+self.tag.tList[d]+c}else{return b+c}}}},handlerInline:function(m,d){var n=m+"\\";var j=n.length-1;var l="";var f=0;var e=0;var b=0;var k="a";var a=false;var g="";var c="";for(var h=(d<0?0:d);h<j;h++){switch(n[h]){case"\\":if(self._inArray(n[h+1],self._meaning)){c=n[++h]}else{c=n[h]}if(a){g+=c}else{l+=c}break;case"`":l+=self.inlineTag.tCode[b];b=1^b;break;case"*":if(n[h+1]=="*"){l+=self.inlineTag.tStrong[f];f=1^f;h++}else{l+=self.inlineTag.tEm[e];e=1^e}break;case"!":k="i";break;case"[":a=true;g="";break;case"]":a=false;break;case"(":if(k=="i"){l+=self.inlineTag.tImg[0]}else{l+=self.inlineTag.tA[0]}break;case")":if(k=="i"){l+=self.inlineTag.tImg[1]}else{l+=self.inlineTag.tA[1]}l+=g;if(k=="i"){l+=self.inlineTag.tImg[2]}else{l+=self.inlineTag.tA[2]}k="";break;default:if(a){g+=n[h]}else{l+=n[h]}}}if(b==1){l+=self.inlineTag.tCode[1]}if(e==1){l+=self.inlineTag.tEm[1]}if(f==1){l+=self.inlineTag.tStrong[1]}return l},};